# Datos en Gatsby

¬°Bienvenido a la cuarta parte del tutorial! ¬°A medio camino! Espero que las cosas empiecen a sentirse bastante c√≥modas üòÄ

## Resumen de la primera mitad del tutorial

Hasta ahora, ha estado aprendiendo a usar React.js, lo poderoso que es poder crear sus _propios_ componentes para que act√∫en como bloques de construcci√≥n personalizados para sitios web.

Tambi√©n ha explorado los componentes de estilo utilizando m√≥dulos CSS.

## ¬øQu√© hay en este tutorial?

En las siguientes cuatro partes del tutorial (incluido este), se sumergir√° en la capa de datos de Gatsby, que es una caracter√≠stica poderosa de Gatsby que le permite crear sitios desde Markdown, WordPress, CMS sin cabeza y otras fuentes de datos de todos los sabores.

**NOTA:** La capa de datos de Gatsby funciona con GraphQL. Para obtener un tutorial detallado sobre GraphQL, recomendamos [How to GraphQL](https://www.howtographql.com/).

## Datos en Gatsby

Un sitio web tiene cuatro partes: HTML, CSS, JS y datos. La primera mitad del tutorial se centr√≥ en los tres primeros. Ahora aprendamos a usar los datos en los sitios de Gatsby.

**¬øQu√© son los datos?**

Una respuesta muy inform√°tica ser√≠a: los datos son cosas como `"strings"`, n√∫meros enteros (`42`), objetos (`{pizza: true}`), etc.

Sin embargo, para trabajar en Gatsby, una respuesta m√°s √∫til es "todo lo que vive fuera de un componente de React".

Hasta ahora, ha estado escribiendo texto y agregando im√°genes _directamente_ en los componentes. Que es una _excelente_ manera de crear muchos sitios web. Pero, a menudo, desea almacenar datos _fuera_ de los componentes y luego llevarlos _al_ componente seg√∫n sea necesario.

Si est√° creando un sitio con WordPress (para que otros contribuyentes tengan una interfaz agradable para agregar y mantener contenido) y Gatsby, los _datos_ del sitio (p√°ginas y publicaciones) est√°n en WordPress y usted extrae esos datos, seg√∫n sea necesario, en su componentes.

Los datos tambi√©n pueden vivir en tipos de archivos como Markdown, CSV, etc., as√≠ como en bases de datos y API de todo tipo.

**La capa de datos de Gatsby le permite extraer datos de estos (y de cualquier otra fuente) directamente en sus componentes**, en la forma que desee.

## Uso de datos no estructurados frente a GraphQL

### ¬øTengo que usar GraphQL y complementos de origen para extraer datos en los sitios de Gatsby?

¬°Absolutamente no! Puede utilizar la API de node `createPages` para extraer datos no estructurados directamente en las p√°ginas de Gatsby, en lugar de hacerlo a trav√©s de la capa de datos GraphQL. Esta es una excelente opci√≥n para sitios peque√±os, mientras que GraphQL y los complementos de origen pueden ayudar a ahorrar tiempo con sitios m√°s complejos.

Consulte la gu√≠a [Uso de Gatsby sin GraphQL](https://www.gatsbyjs.com/docs/using-gatsby-without-graphql/) para aprender c√≥mo extraer datos en su sitio de Gatsby utilizando la API de node `createPages` y para ver un sitio de ejemplo!

### ¬øCu√°ndo utilizo datos no estructurados vs GraphQL?

Si est√° construyendo un sitio peque√±o, una forma eficiente de hacerlo es extraer datos no estructurados como se describe en esta gu√≠a, utilizando la API `createPages`, y luego, si el sitio se vuelve m√°s complejo m√°s adelante, pasa a construir sitios m√°s complejos, o desea transformar sus datos, siga estos pasos:

1. Consulte la [biblioteca de complementos](https://www.gatsbyjs.com/plugins/) para ver si los complementos fuente y/o los complementos transformadores que le gustar√≠a usar ya existen
2. Si no existen, lea la gu√≠a de [creaci√≥n de complementos](https://www.gatsbyjs.com/docs/creating-plugins/) y considere crear la suya propia!

### C√≥mo la capa de datos de Gatsby usa GraphQL para extraer datos en componentes

Hay muchas opciones para cargar datos en los componentes de React. Uno de los m√°s populares y poderosos es una tecnolog√≠a llamada [GraphQL](https://graphql.org/).

GraphQL se invent√≥ en Facebook para ayudar a los ingenieros de productos a _incorporar_ los datos necesarios en los componentes.

GraphQL es un lenguaje de consulta (la parte _QL_ de su nombre). Si est√° familiarizado con SQL, funciona de manera muy similar. Usando una sintaxis especial, usted describe los datos que desea en su componente y luego se le dan esos datos.

Gatsby usa GraphQL para permitir que los componentes declaren los datos que necesitan.

## Crea un nuevo sitio de ejemplo

Cree otro sitio nuevo para esta parte del tutorial. Vas a crear un blog de Markdown llamado "Pandas Eating Lots". Est√° dedicado a mostrar las mejores im√°genes y videos de pandas comiendo mucha comida. A lo largo del camino, sumergir√° sus dedos de los pies en GraphQL y la compatibilidad con Markdown de Gatsby.

Abra una nueva ventana de terminal y ejecute los siguientes comandos para crear un nuevo sitio de Gatsby en un directorio llamado `tutorial-part-four`. Luego navega al nuevo directorio:

```shell
gatsby new tutorial-part-four https://github.com/gatsbyjs/gatsby-starter-hello-world
cd tutorial-part-four
```

Luego instale algunas otras dependencias necesarias en la ra√≠z del proyecto. Usar√°s el tema de tipograf√≠a "Kirkham" y probar√°s una biblioteca CSS-in-JS, ["Emotion"](https://emotion.sh/):

```shell
npm install --save gatsby-plugin-typography typography react-typography typography-theme-kirkham gatsby-plugin-emotion @emotion/core
```

Configure un sitio similar al que termin√≥ en la [Parte Tres](). Este sitio tendr√° un componente de dise√±o y dos componentes de p√°gina:

```jsx
// src/components/layout.js

import React from "react";
import { css } from "@emotion/core";
import { Link } from "gatsby";

import { rhythm } from "../utils/typography";

export default function Layout({ children }) {
  return (
    <div
      css={css`
        margin: 0 auto;
        max-width: 700px;
        padding: ${rhythm(2)};
        padding-top: ${rhythm(1.5)};
      `}
    >
      <Link to={`/`}>
        <h3
          css={css`
            margin-bottom: ${rhythm(2)};
            display: inline-block;
            font-style: normal;
          `}
        >
          Pandas Eating Lots
        </h3>
      </Link>
      <Link
        to={`/about/`}
        css={css`
          float: right;
        `}
      >
        About
      </Link>
      {children}
    </div>
  );
}
```

```jsx
// src/pages/index.js

import React from "react";
import Layout from "../components/layout";

export default function Home() {
  return (
    <Layout>
      <h1>Amazing Pandas Eating Things</h1>
      <div>
        <img
          src="https://2.bp.blogspot.com/-BMP2l6Hwvp4/TiAxeGx4CTI/AAAAAAAAD_M/XlC_mY3SoEw/s1600/panda-group-eating-bamboo.jpg"
          alt="Group of pandas eating bamboo"
        />
      </div>
    </Layout>
  );
}
```

```jsx
// src/pages/about.js

import React from "react";
import Layout from "../components/layout";

export default function About() {
  return (
    <Layout>
      <h1>About Pandas Eating Lots</h1>
      <p>
        We're the only site running on your computer dedicated to showing the
        best photos and videos of pandas eating lots of food.
      </p>
    </Layout>
  );
}
```

```javascript
// src/utils/typography.js

import Typography from "typography";
import kirkhamTheme from "typography-theme-kirkham";

const typography = new Typography(kirkhamTheme);

export default typography;
export const rhythm = typography.rhythm;
```

```javascript
// gatsby-config.js

module.exports = {
  plugins: [
    `gatsby-plugin-emotion`,
    {
      resolve: `gatsby-plugin-typography`,
      options: {
        pathToConfigModule: `src/utils/typography`,
      },
    },
  ],
};
```

Agregue los archivos anteriores y luego ejecute `gatsby develop`, como de costumbre, y deber√≠a ver lo siguiente:

![](https://www.gatsbyjs.com/static/9a136a7536d2f4b315d446f6a1a83725/321ea/start.png)

Tiene otro sitio peque√±o con un dise√±o y dos p√°ginas.

Ahora puedes empezar a consultar üòã

## Tu primera consulta GraphQL

Al crear sitios, probablemente desee reutilizar datos comunes, como el _t√≠tulo_ del sitio, por ejemplo. Mire la p√°gina `/about/`. Notar√° que tiene el t√≠tulo del sitio (`Pandas Eating Lots`) tanto en el componente de dise√±o (el encabezado del sitio) como en el `<h1 />` de la p√°gina `about.js` (el encabezado de la p√°gina).

Pero, ¬øqu√© sucede si desea cambiar el t√≠tulo del sitio en el futuro? Deber√≠a buscar el t√≠tulo en todos sus componentes y editar cada instancia. Esto es engorroso y propenso a errores, especialmente para sitios m√°s grandes y complejos. En su lugar, puede almacenar el t√≠tulo en una ubicaci√≥n y hacer referencia a esa ubicaci√≥n desde otros archivos; cambie el t√≠tulo en un solo lugar, y Gatsby _colocar√°_ su t√≠tulo actualizado en archivos que hagan referencia a √©l.

El lugar para estos bits comunes de datos es el objeto `siteMetadata` en el archivo `gatsby-config.js`. Agregue el t√≠tulo de su sitio al archivo `gatsby-config.js`:

```javascript
// gatsby-config.js

module.exports = {
  siteMetadata: {
    title: `Title from siteMetadata`,
  },
  plugins: [
    `gatsby-plugin-emotion`,
    {
      resolve: `gatsby-plugin-typography`,
      options: {
        pathToConfigModule: `src/utils/typography`,
      },
    },
  ],
};
```

Reinicie el servidor de desarrollo.

### Utilizar una consulta de p√°gina

Ahora el t√≠tulo del sitio est√° disponible para ser consultado; Agr√©guelo al archivo `about.js` mediante una [consulta de p√°gina](https://www.gatsbyjs.com/docs/page-query):

```jsx
// src/pages/about.js

import React from "react";
import { graphql } from "gatsby";
import Layout from "../components/layout";

export default function About({ data }) {
  return (
    <Layout>
      <h1>About {data.site.siteMetadata.title}</h1>
      <p>
        We're the only site running on your computer dedicated to showing the
        best photos and videos of pandas eating lots of food.
      </p>
    </Layout>
  );
}

export const query = graphql`
  query {
    site {
      siteMetadata {
        title
      }
    }
  }
`;
```

¬°Funcion√≥! üéâ

![](https://www.gatsbyjs.com/static/4df7cdfeb994c1a07b4557f0f6010d91/c5bb3/site-metadata-title.png)

La consulta b√°sica de GraphQL que recupera el `title` en los cambios de `about.js` es:

```graphql
<!-- src/pages/about.js -->

{
  site {
    siteMetadata {
      title
    }
  }
}
```

> üí° En la [quinta parte](), conocer√° una herramienta que nos permite explorar de forma interactiva los datos disponibles a trav√©s de GraphQL y ayudar a formular consultas como la anterior.

Las consultas de p√°gina se encuentran fuera de la definici√≥n del componente, por convenci√≥n al final de un archivo de componente de p√°gina, y solo est√°n disponibles en los componentes de p√°gina.

### Utilice una StaticQuery

[StaticQuery](https://www.gatsbyjs.com/docs/static-query/) es una nueva API introducida en Gatsby v2 que permite que los componentes que no son de p√°gina (como el componente `layout.js`) recuperen datos a trav√©s de consultas GraphQL. Usemos su versi√≥n de hook reci√©n introducida: `useStaticQuery`.

Contin√∫e y realice algunos cambios en su archivo `src/components/layout.js` para usar el hook `useStaticQuery` y una referencia `{data.site.siteMetadata.title}` que usa estos datos. Cuando haya terminado, su archivo se ver√° as√≠:

```jsx
// src/components/layout.js

import React from "react";
import { css } from "@emotion/core";
import { useStaticQuery, Link, graphql } from "gatsby";

import { rhythm } from "../utils/typography";
export default function Layout({ children }) {
  const data = useStaticQuery(
    graphql`
      query {
        site {
          siteMetadata {
            title
          }
        }
      }
    `
  );
  return (
    <div
      css={css`
        margin: 0 auto;
        max-width: 700px;
        padding: ${rhythm(2)};
        padding-top: ${rhythm(1.5)};
      `}
    >
      <Link to={`/`}>
        <h3
          css={css`
            margin-bottom: ${rhythm(2)};
            display: inline-block;
            font-style: normal;
          `}
        >
          {data.site.siteMetadata.title}
        </h3>
      </Link>
      <Link
        to={`/about/`}
        css={css`
          float: right;
        `}
      >
        About
      </Link>
      {children}
    </div>
  );
}
```

¬°Otro acierto! üéâ

![](https://www.gatsbyjs.com/static/500fd2f12d69813d2bbe6d669eaf3ce8/8ce52/site-metadata-two-titles.png)

¬øPor qu√© utilizar dos consultas diferentes aqu√≠? Estos ejemplos fueron una introducci√≥n r√°pida a los tipos de consultas, c√≥mo se formatean y d√≥nde se pueden usar. Por ahora, tenga en cuenta que solo las p√°ginas pueden realizar consultas de p√°gina. Los componentes que no son de p√°gina, como Layout, pueden usar StaticQuery. La [parte 7](https://www.gatsbyjs.com/tutorial/part-seven/) del tutorial los explica con mayor profundidad.

Pero restauremos el t√≠tulo real.

Uno de los principios fundamentales de Gatsby es que _los creadores necesitan una conexi√≥n inmediata con lo que est√°n creando_ ([nota del sombrero a Bret Victor](http://blog.ezyang.com/2012/02/transcript-of-inventing-on-principle/)). En otras palabras, cuando realiza cualquier cambio en el c√≥digo, deber√≠a ver inmediatamente el efecto de ese cambio. Manipula una entrada de Gatsby y ve la nueva salida que aparece en la pantalla.

De modo que, en casi todas partes, los cambios que realice se aplicar√°n de inmediato. Edite el archivo `gatsby-config.js` nuevamente, esta vez cambiando el `title` a "Pandas Eating Lots". El cambio deber√≠a aparecer muy r√°pidamente en las p√°ginas de su sitio.

## ¬øQu√© viene despu√©s?

A continuaci√≥n, aprender√° a introducir datos en su sitio de Gatsby mediante GraphQL con complementos de origen en la [quinta parte]() del tutorial.
